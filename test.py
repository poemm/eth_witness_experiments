
import inspect  #if verbose: print(inspect.currentframe().f_code.co_name,idx)
import pprint

verbose = 0


# PLEASE COMMENT IN ONE `gen_Block_Witness` AND ONE `parse_Block_Witness` BELOW
from parse_generate_spec import gen_Block_Witness
from parse_generate_spec import parse_Block_Witness
#from parse_alternative_implementations import parse_Block_Witness



def compare_nested_lists_and_tuples(in1, in2):
  print(in1,in2)
  if type(in1) in {tuple, list}:
    assert len(in1) == len(in2)
    for i in range(len(in1)):
      compare_nested_lists_and_tuples(in1[i], in2[i])
  else:
    assert in1==in2






def test(testid, test_text, test_hex):
  print()
  print(testid)
  test_hex_to_bytes = bytes.fromhex(test_hex)

  output = bytearray([])
  gen_Block_Witness(output, test_text)
  #print(output.hex())

  try:
    block_witness = parse_Block_Witness(output, 0)
  except AssertionError:
    print("There was an AssertionError")

  #print(block_witness)

  print(output==test_hex_to_bytes)
  if output!=test_hex_to_bytes:
    print("output",output)
    print("test_hex_to_bytes",test_hex_to_bytes)
    print(block_witness)
    pprint.pprint(block_witness)


def run_tests():

  testid = "just the root hash"
  test_text=\
( "Ethereum 1x witness",
  ("version", 1),
  ( "tree",
    ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
  ),
)
  test_hex = "01bb00030000000000000000000000000000000000000000000000000000000000000000"
  test(testid, test_text, test_hex)


  testid = "two trees, both just the root hash"
  test_text=\
( "Ethereum 1x witness",
  ("version", 1),
  ( "tree",
    ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
  ),
  ( "tree",
    ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
  ),
)
  test_hex = "01bb00030000000000000000000000000000000000000000000000000000000000000000bb00030000000000000000000000000000000000000000000000000000000000000000"
  test(testid, test_text, test_hex)


  testid = "simplest branch node"
  test_text=\
( "Ethereum 1x witness",
  ("version", 1),
  ( "tree",
    ( "branch",
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      None,
      None,
      None,
      None,
      None,
      None,
      None,
      None,
      None,
      None,
      None,
      None,
      None,
      None,
    )
  ),
)
  test_hex = "01bb0000c000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000"
  test(testid, test_text, test_hex)


  testid = "full branch node"
  test_text=\
( "Ethereum 1x witness",
  ("version", 1),
  ( "tree",
    ( "branch",
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
    )
  ),
)
  test_hex = "01bb0000ffff030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000"
  test(testid, test_text, test_hex)


  testid = "two trees with full branch node"
  test_text=\
( "Ethereum 1x witness",
  ("version", 1),
  ( "tree",
    ( "branch",
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
    )
  ),
  ( "tree",
    ( "branch",
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
    )
  )
)
  test_hex = "01bb0000ffff030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000bb0000ffff030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000"
  test(testid, test_text, test_hex)


  testid = "simple nested branch node"
  test_text=\
( "Ethereum 1x witness",
  ("version", 1),
  ( "tree",
    ( "branch",
      ("branch",
        ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
        ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
        None,
        None,
        None,
        None,
        None,
        None,
        None,
        None,
        None,
        None,
        None,
        None,
        None,
        None,
      ),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      None,
      None,
      None,
      None,
      None,
      None,
      None,
      None,
      None,
      None,
      None,
      None,
      None,
      None,
    )
  ),
)
  test_hex = "01bb0000c00000c000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000"
  test(testid, test_text, test_hex)


  testid = "simple extension with child hash"
  test_text=\
( "Ethereum 1x witness",
  ("version", 1),
  ( "tree",
    ( "extension", (1, '00'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
    ),
  ),
)
  test_hex = "01bb00010100030000000000000000000000000000000000000000000000000000000000000000"
  test(testid, test_text, test_hex)


  testid = "simple extension with child branch"
  test_text=\
( "Ethereum 1x witness",
  ("version", 1),
  ( "tree",
    ( "extension", (1, '00'),
      ("branch",
        ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
        ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
        None,
        None,
        None,
        None,
        None,
        None,
        None,
        None,
        None,
        None,
        None,
        None,
        None,
        None,
      ),
    ),
  ),
)
  test_hex = "01bb0001010000c000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000"
  test(testid, test_text, test_hex)


  testid = "longest extension with child hash"
  test_text=\
( "Ethereum 1x witness",
  ("version", 1),
  ( "tree",
    ( "extension", (64, '0000000000000000000000000000000000000000000000000000000000000000'),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
    ),
  ),
)
  test_hex = "01bb0001400000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000"
  test(testid, test_text, test_hex)


  testid = "simple externally owned account"
  test_text=\
( "Ethereum 1x witness",
  ("version", 1),
  ( "tree",
    ( "account",
      (64, '0000000000000000000000000000000000000000000000000000000000000000'),
      '0000000000000000000000000000000000000000',
      '0000000000000000000000000000000000000000000000000000000000000000',
      '0000000000000000000000000000000000000000000000000000000000000000',
    ),
  ),
)
  test_hex = "01bb0002000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
  test(testid, test_text, test_hex)


  testid = "Parsing error: simple externally owned account"
  test_text=\
( "Ethereum 1x witness",
  ("version", 1),
  ( "tree",
    ( "account",
      (65, '000000000000000000000000000000000000000000000000000000000000000000'),
      '0000000000000000000000000000000000000000',
      '0000000000000000000000000000000000000000000000000000000000000000',
      '0000000000000000000000000000000000000000000000000000000000000000',
    ),
  ),
)
  test_hex = "01bb000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"
  test(testid, test_text, test_hex)


  testid = "simple contract account"
  test_text=\
( "Ethereum 1x witness",
  ("version", 1),
  ( "tree",
    ( "account",
      (64, '0000000000000000000000000000000000000000000000000000000000000000'),
      '0000000000000000000000000000000000000000',
      '0000000000000000000000000000000000000000000000000000000000000000',
      '0000000000000000000000000000000000000000000000000000000000000000',
      '',
      ( 'hash','0000000000000000000000000000000000000000000000000000000000000000' ),
    ),
  ),
)
  test_hex = "01bb000201000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000"
  test(testid, test_text, test_hex)


  testid = "64 nested branch nodes"
  test_text=\
( "Ethereum 1x witness",
 ("version", 1),
 ( "tree",
  ("branch",
   ("branch",
    ("branch",
     ("branch",
      ("branch",
       ("branch",
        ("branch",
         ("branch",
          ("branch",
           ("branch",
            ("branch",
             ("branch",
              ("branch",
               ("branch",
                ("branch",
                 ("branch",
                  ("branch",
                   ("branch",
                    ("branch",
                     ("branch",
                      ("branch",
                       ("branch",
                        ("branch",
                         ("branch",
                          ("branch",
                           ("branch",
                            ("branch",
                             ("branch",
                              ("branch",
                               ("branch",
                                ("branch",
                                 ("branch",
                                  ("branch",
                                   ("branch",
                                    ("branch",
                                     ("branch",
                                      ("branch",
                                       ("branch",
                                        ("branch",
                                         ("branch",
                                          ("branch",
                                           ("branch",
                                            ("branch",
                                             ("branch",
                                              ("branch",
                                               ("branch",
                                                ("branch",
                                                 ("branch",
                                                  ("branch",
                                                   ("branch",
                                                    ("branch",
                                                     ("branch",
                                                      ("branch",
                                                       ("branch",
                                                        ("branch",
                                                         ("branch",
                                                          ("branch",
                                                           ("branch",
                                                            ("branch",
                                                             ("branch",
                                                              ("branch",
                                                               ("branch",
                                                                ("branch",
                                                                 ("branch",
                                                                  ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                                  ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                                  None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                                 ),
                                                                 ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                                 None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                                ),
                                                                ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                                None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                               ),
                                                               ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                               None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                              ),
                                                              ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                              None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                             ),
                                                             ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                             None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                            ),
                                                            ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                            None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                           ),
                                                           ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                           None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                          ),
                                                          ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                          None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                         ),
                                                         ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                         None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                        ),
                                                        ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                        None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                       ),
                                                       ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                       None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                      ),
                                                      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                      None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                     ),
                                                     ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                     None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                    ),
                                                    ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                    None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                   ),
                                                   ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                   None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                  ),
                                                  ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                  None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                 ),
                                                 ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                 None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                ),
                                                ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                               ),
                                               ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                               None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                              ),
                                              ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                              None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                             ),
                                             ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                             None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                            ),
                                            ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                            None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                           ),
                                           ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                           None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                          ),
                                          ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                          None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                         ),
                                         ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                         None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                        ),
                                        ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                        None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                       ),
                                       ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                       None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                      ),
                                      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                      None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                     ),
                                     ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                     None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                    ),
                                    ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                    None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                   ),
                                   ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                   None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                  ),
                                  ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                  None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                 ),
                                 ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                 None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                ),
                                ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                               ),
                               ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                               None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                              ),
                              ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                              None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                             ),
                             ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                             None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                            ),
                            ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                            None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                           ),
                           ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                           None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                          ),
                          ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                          None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                         ),
                         ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                         None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                        ),
                        ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                        None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                       ),
                       ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                       None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                      ),
                      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                      None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                     ),
                     ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                     None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                    ),
                    ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                    None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                   ),
                   ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                   None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                  ),
                  ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                  None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                 ),
                 ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                 None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                ),
                ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                None, None, None, None, None, None, None, None, None, None, None, None, None, None,
               ),
               ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
               None, None, None, None, None, None, None, None, None, None, None, None, None, None,
              ),
              ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
              None, None, None, None, None, None, None, None, None, None, None, None, None, None,
             ),
             ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
             None, None, None, None, None, None, None, None, None, None, None, None, None, None,
            ),
            ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
            None, None, None, None, None, None, None, None, None, None, None, None, None, None,
           ),
           ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
           None, None, None, None, None, None, None, None, None, None, None, None, None, None,
          ),
          ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
          None, None, None, None, None, None, None, None, None, None, None, None, None, None,
         ),
         ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
         None, None, None, None, None, None, None, None, None, None, None, None, None, None,
        ),
        ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
        None, None, None, None, None, None, None, None, None, None, None, None, None, None,
       ),
       ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
       None, None, None, None, None, None, None, None, None, None, None, None, None, None,
      ),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      None, None, None, None, None, None, None, None, None, None, None, None, None, None,
     ),
     ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
     None, None, None, None, None, None, None, None, None, None, None, None, None, None,
    ),
    ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
    None, None, None, None, None, None, None, None, None, None, None, None, None, None,
   ),
   ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
   None, None, None, None, None, None, None, None, None, None, None, None, None, None,
  ),
 ),
)
  test_hex = "01bb0000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000"
  test(testid, test_text, test_hex)


  testid = "64 nested branch nodes, then account"
  test_text=\
( "Ethereum 1x witness",
 ("version", 1),
 ( "tree",
  ("branch",
   ("branch",
    ("branch",
     ("branch",
      ("branch",
       ("branch",
        ("branch",
         ("branch",
          ("branch",
           ("branch",
            ("branch",
             ("branch",
              ("branch",
               ("branch",
                ("branch",
                 ("branch",
                  ("branch",
                   ("branch",
                    ("branch",
                     ("branch",
                      ("branch",
                       ("branch",
                        ("branch",
                         ("branch",
                          ("branch",
                           ("branch",
                            ("branch",
                             ("branch",
                              ("branch",
                               ("branch",
                                ("branch",
                                 ("branch",
                                  ("branch",
                                   ("branch",
                                    ("branch",
                                     ("branch",
                                      ("branch",
                                       ("branch",
                                        ("branch",
                                         ("branch",
                                          ("branch",
                                           ("branch",
                                            ("branch",
                                             ("branch",
                                              ("branch",
                                               ("branch",
                                                ("branch",
                                                 ("branch",
                                                  ("branch",
                                                   ("branch",
                                                    ("branch",
                                                     ("branch",
                                                      ("branch",
                                                       ("branch",
                                                        ("branch",
                                                         ("branch",
                                                          ("branch",
                                                           ("branch",
                                                            ("branch",
                                                             ("branch",
                                                              ("branch",
                                                               ("branch",
                                                                ("branch",
                                                                 ("branch",
                                                                  ("account",
                                                                   (0, ''),
                                                                   '0000000000000000000000000000000000000000',
                                                                   '0000000000000000000000000000000000000000000000000000000000000000',
                                                                   '0000000000000000000000000000000000000000000000000000000000000000',
                                                                  ),
                                                                  ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                                  None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                                 ),
                                                                 ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                                 None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                                ),
                                                                ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                                None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                               ),
                                                               ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                               None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                              ),
                                                              ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                              None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                             ),
                                                             ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                             None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                            ),
                                                            ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                            None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                           ),
                                                           ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                           None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                          ),
                                                          ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                          None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                         ),
                                                         ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                         None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                        ),
                                                        ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                        None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                       ),
                                                       ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                       None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                      ),
                                                      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                      None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                     ),
                                                     ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                     None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                    ),
                                                    ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                    None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                   ),
                                                   ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                   None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                  ),
                                                  ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                  None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                 ),
                                                 ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                 None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                                ),
                                                ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                                None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                               ),
                                               ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                               None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                              ),
                                              ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                              None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                             ),
                                             ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                             None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                            ),
                                            ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                            None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                           ),
                                           ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                           None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                          ),
                                          ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                          None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                         ),
                                         ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                         None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                        ),
                                        ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                        None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                       ),
                                       ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                       None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                      ),
                                      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                      None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                     ),
                                     ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                     None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                    ),
                                    ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                    None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                   ),
                                   ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                   None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                  ),
                                  ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                  None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                 ),
                                 ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                 None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                                ),
                                ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                                None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                               ),
                               ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                               None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                              ),
                              ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                              None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                             ),
                             ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                             None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                            ),
                            ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                            None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                           ),
                           ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                           None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                          ),
                          ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                          None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                         ),
                         ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                         None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                        ),
                        ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                        None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                       ),
                       ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                       None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                      ),
                      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                      None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                     ),
                     ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                     None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                    ),
                    ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                    None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                   ),
                   ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                   None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                  ),
                  ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                  None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                 ),
                 ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                 None, None, None, None, None, None, None, None, None, None, None, None, None, None,
                ),
                ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
                None, None, None, None, None, None, None, None, None, None, None, None, None, None,
               ),
               ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
               None, None, None, None, None, None, None, None, None, None, None, None, None, None,
              ),
              ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
              None, None, None, None, None, None, None, None, None, None, None, None, None, None,
             ),
             ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
             None, None, None, None, None, None, None, None, None, None, None, None, None, None,
            ),
            ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
            None, None, None, None, None, None, None, None, None, None, None, None, None, None,
           ),
           ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
           None, None, None, None, None, None, None, None, None, None, None, None, None, None,
          ),
          ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
          None, None, None, None, None, None, None, None, None, None, None, None, None, None,
         ),
         ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
         None, None, None, None, None, None, None, None, None, None, None, None, None, None,
        ),
        ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
        None, None, None, None, None, None, None, None, None, None, None, None, None, None,
       ),
       ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
       None, None, None, None, None, None, None, None, None, None, None, None, None, None,
      ),
      ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
      None, None, None, None, None, None, None, None, None, None, None, None, None, None,
     ),
     ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
     None, None, None, None, None, None, None, None, None, None, None, None, None, None,
    ),
    ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
    None, None, None, None, None, None, None, None, None, None, None, None, None, None,
   ),
   ("hash", '0000000000000000000000000000000000000000000000000000000000000000'),
   None, None, None, None, None, None, None, None, None, None, None, None, None, None,
  ),
 ),
)
  test_hex = "01bb0000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c00000c0000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000"
  test(testid, test_text, test_hex)

if __name__=="__main__":

  run_tests()

